#
# $Id: Makefile 131597 2009-04-09 06:34:51Z norton $
#

MODULES = \
	tbf \
	tbf_driver \
	thrift_contract_parser

PLUGINS = \
	ubf_thrift_plugin

EUNITTESTS = \
	thrift_plugin_app \
	thrift_plugin_sup \
	thrift_plugin_test

MY_UBF_EBIN = ./example-symlink-to-ubf-ebin
MY_UBF_INCLUDE = ./example-symlink-to-ubf-include

# include erl make
include ../priv/make/erl_make.mk

ERL_COMPILE_FLAGS += \
	-I $(MY_UBF_INCLUDE) \
	-pz $(MY_UBF_EBIN)

TESTONLY_ERL_COMPILE_FLAGS += \
	-I $(MY_UBF_INCLUDE) \
	-pz $(MY_UBF_EBIN)

ERL_FLAGS += \
	-pz $(MY_UBF_EBIN)

# standard targets
check: all
	-rm -f ./*.log
	$(RUNERL1) -noinput -noshell -pz $(EUNITTEST_DIR) -pz $(MY_UBF_EBIN) \
		-s thrift_plugin_test do_eunit \
		-s erlang halt \
		> ./check.log

# EDoc
edoc: all
	erl -noshell -noinput -eval 'file:set_cwd(".."), {ok, Dir} = file:get_cwd(), edoc:application(ubf_thrift, Dir, [{dir, Dir ++ "/edoc"}]), erlang:halt(0).'
### replace date with \$Id:\$
	perl -i -pe 's!>Generated by EDoc[^<]+<!>Generated EDoc, \$$Id\$$<!g;' \
		../edoc/*.html
### remove time tags
	perl -i -pe 's!(Version:</b>)([^<]+)!$$1 \$$Id!;' \
		../edoc/*.html
